select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT=data.frame(solution=as.character(),k=as.numeric(),ngenes=as.numeric(),mean.Silhouette=as.numeric(),C.Index=as.numeric(),stringsAsFactors = FALSE)
for(i in 1:nrow(NonDom_solutions)){
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- data[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
# hsp_class= as.factor(classify(data[R,],C,method=distancetype))
#  hsp_classdf= as.data.frame(hsp_class)
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotalpval <- 1 - pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=coxph(surv_formula,data=predicted_classdf)
CI=concordance.index(predict(coxsimple),surv.time=Surv[,1],surv.event=Surv[,2],outx=FALSE)$c.index
mean_Sil =mean(silhouette(as.numeric(predicted_class),D)[,3])
row= c(name,k,length(genes),mean_Sil,CI)
RESULT[nrow(RESULT)+1,]=row
#print(row)
}
return(RESULT)
}
RESULT<- non.dominated(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
RESULT
output$Solutions
class(output)
print("object must be of class 'galgo.summary' \n try running 'non.dominated,summary' function")
solution.selection <- function(galgo_summary){
if (!methods::is(output, "galgo.summary")) {
stop("object must be of class 'galgo.summary': Try running 'non.dominated,summary' function")
}
best_sol=NULL
for(i in unique(galgo_summary$k)){
best_sol=c(best_sol,galgo_summary[galgo_summary$k==i,"solution"][which.max(galgo_summary[galgo_summary$k==i,"trainCI"])])
}
return(best_sol)
}
head(RESULT)
solution.selection <- function(galgo_summary){
if (!methods::is(output, "galgo.summary")) {
stop("object must be of class 'galgo.summary': Try running 'non.dominated,summary' function")
}
best_sol=NULL
for(i in unique(galgo_summary$k)){
best_sol=c(best_sol,galgo_summary[galgo_summary$k==i,"solution"][which.max(galgo_summary[galgo_summary$k==i,"C.Index"])])
}
return(best_sol)
}
RESULT<- non.dominated.summary(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
best_sol<- solution.selection(RESULT)
non.dominated.summary <- function(output,data, Surv, distancetype= "pearson",usegpu=FALSE){
if (!methods::is(output, "galgo.Obj")) {
stop("object must be of class 'galgo.Obj'")
}
require(survcomp)
require(cluster)
output_df<- toDataFrame(output)
NonDom_solutions<- output_df[output_df$Rank==1,]
select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT=data.frame(solution=as.character(),k=as.numeric(),ngenes=as.numeric(),mean.Silhouette=as.numeric(),C.Index=as.numeric(),stringsAsFactors = FALSE)
for(i in 1:nrow(NonDom_solutions)){
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- data[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotalpval <- 1 - pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=coxph(surv_formula,data=predicted_classdf)
CI=concordance.index(predict(coxsimple),surv.time=Surv[,1],surv.event=Surv[,2],outx=FALSE)$c.index
mean_Sil =mean(silhouette(as.numeric(predicted_class),D)[,3])
row= c(name,k,length(genes),mean_Sil,CI)
RESULT[nrow(RESULT)+1,]=row
#print(row)
}
class(RESULT) <- "galgo.summary"
return(RESULT)
}
solution.selection <- function(galgo_summary){
if (!methods::is(output, "galgo.summary")) {
stop("object must be of class 'galgo.summary': Try running 'non.dominated,summary' function")
}
best_sol=NULL
for(i in unique(galgo_summary$k)){
best_sol=c(best_sol,galgo_summary[galgo_summary$k==i,"solution"][which.max(galgo_summary[galgo_summary$k==i,"C.Index"])])
}
return(best_sol)
}
RESULT<- non.dominated.summary(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
best_sol<- solution.selection(RESULT)
class(RESULT)
solution.selection <- function(galgo_summary){
if (!methods::is(galgo_summary, "galgo.summary")) {
stop("object must be of class 'galgo.summary': Try running 'non.dominated,summary' function")
}
best_sol=NULL
for(i in unique(galgo_summary$k)){
best_sol=c(best_sol,galgo_summary[galgo_summary$k==i,"solution"][which.max(galgo_summary[galgo_summary$k==i,"C.Index"])])
}
return(best_sol)
}
best_sol<- solution.selection(RESULT)
head(RESULT)
RESULT<- non.dominated.summary(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
head(RESULT)
RESULT=data.frame(solution=as.character(),k=as.numeric(),ngenes=as.numeric(),mean.Silhouette=as.numeric(),C.Index=as.numeric(),stringsAsFactors = FALSE)
head(RESULT)
NonDom_solutions
for(i in 1:nrow(NonDom_solutions)){
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- data[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotalpval <- 1 - pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=coxph(surv_formula,data=predicted_classdf)
CI=concordance.index(predict(coxsimple),surv.time=Surv[,1],surv.event=Surv[,2],outx=FALSE)$c.index
mean_Sil =mean(silhouette(as.numeric(predicted_class),D)[,3])
row= c(name,k,length(genes),mean_Sil,CI)
RESULT[nrow(RESULT)+1,]=row
#print(row)
}
output_df<- toDataFrame(output)
NonDom_solutions<- output_df[output_df$Rank==1,]
select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT=data.frame(solution=as.character(),k=as.numeric(),ngenes=as.numeric(),mean.Silhouette=as.numeric(),C.Index=as.numeric(),stringsAsFactors = FALSE)
i=1
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- prob_matrix[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotal <- survfit(surv_formula)
Surv=OS
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotalpval <- 1 - pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=coxph(surv_formula,data=predicted_classdf)
CI=concordance.index(predict(coxsimple),surv.time=Surv[,1],surv.event=Surv[,2],outx=FALSE)$c.index
mean_Sil =mean(silhouette(as.numeric(predicted_class),D)[,3])
row= c(name,k,length(genes),mean_Sil,CI)
row
dim(RESULT)
length(row)
RESULT[nrow(RESULT)+1,]=row
RESULT
#' @param output
#' @param data
#' @param Surv
#' @param distancetype
#' @param usegpu
#'
#' @return
#' @export
#'
#' @examples
non.dominated.summary <- function(output,data, Surv, distancetype= "pearson",usegpu=FALSE){
if (!methods::is(output, "galgo.Obj")) {
stop("object must be of class 'galgo.Obj'")
}
require(survcomp)
require(cluster)
output_df<- toDataFrame(output)
NonDom_solutions<- output_df[output_df$Rank==1,]
select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT=data.frame(solution=as.character(),k=as.numeric(),ngenes=as.numeric(),mean.Silhouette=as.numeric(),C.Index=as.numeric(),stringsAsFactors = FALSE)
for(i in 1:nrow(NonDom_solutions)){
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- data[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotalpval <- 1 - pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=coxph(surv_formula,data=predicted_classdf)
CI=concordance.index(predict(coxsimple),surv.time=Surv[,1],surv.event=Surv[,2],outx=FALSE)$c.index
mean_Sil =mean(silhouette(as.numeric(predicted_class),D)[,3])
row= c(name,k,length(genes),mean_Sil,CI)
RESULT[nrow(RESULT)+1,]=row
#print(row)
}
class(RESULT) <- "galgo.summary"
return(RESULT)
}
non_dominated<- non.dominated.summary(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
non_dominated
#' @param output
#' @param data
#' @param Surv
#' @param distancetype
#' @param usegpu
#'
#' @return
#' @export
#'
#' @examples
non.dominated.summary <- function(output,data, Surv, distancetype= "pearson",usegpu=FALSE){
if (!methods::is(output, "galgo.Obj")) {
stop("object must be of class 'galgo.Obj'")
}
require(survcomp)
require(cluster)
output_df<- toDataFrame(output)
NonDom_solutions<- output_df[output_df$Rank==1,]
select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT=data.frame(solution=as.character(),k=as.numeric(),ngenes=as.numeric(),mean.Silhouette=as.numeric(),C.Index=as.numeric(),stringsAsFactors = FALSE)
for(i in 1:nrow(NonDom_solutions)){
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- data[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
surv_formula <- as.formula("Surv~ predicted_class")
tumortotal <- survfit(surv_formula)
totalsdf <- survdiff(surv_formula)
tumortotalpval <- 1 - pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=coxph(surv_formula,data=predicted_classdf)
CI=concordance.index(predict(coxsimple),surv.time=Surv[,1],surv.event=Surv[,2],outx=FALSE)$c.index
mean_Sil =mean(silhouette(as.numeric(predicted_class),D)[,3])
row= c(name,k,length(genes),mean_Sil,CI)
RESULT[nrow(RESULT)+1,]=row
#print(row)
}
#class(RESULT) <- "galgo.summary"
return(RESULT)
}
non_dominated<- non.dominated.summary(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
non_dominated
?class
RESULT<- non.dominated.summary(output=output,Surv=OS, data= prob_matrix, distancetype =distancetype, usegpu= usegpu )
RESULT
head(output_df)
create.centroids<- function(output,solution.names,train.set){
CentroidsList<-list()
output_df<- toDataFrame(output)
for(j in solution.names){
genes<- output_df[j,"Genes"][[1]]
k<- output_df[j,"k"]
name<- paste0("Gaglo.",k)
Sub_matrix<- train.set[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
CentroidsList[[name]]=Centroids
}
return(CentroidsList)
}
CentroidsList <- create.centroids(output, solution.names = best_sol, train.set = prob_matrix)
CentroidsList
names(CentroidsList)
classify.multiple(data, centroid.list,distancetype=distancetype){
classes<- matrix(rep(NA,ncol(data)*length(centroid.list)),ncol=length(centroid.list))
as.data.frame<- classes
colnames(classes)<- names(centroid.list)
rownames(classes)<- colnames(data)
for( i in 1:length(centroid.list)){
centroids<- centroid.list[[i]]
name<- names(centroid.list)[i]
genes<- rownames(centroids)
k<- ncol(centroids)
Sub_matrix<- data[genes,]
predicted_class <- classify(Sub_matrix,centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
classes[,name]=predicted_class
}
return(classes)
}
classify.multiple<- function(data, centroid.list,distancetype=distancetype){
classes<- matrix(rep(NA,ncol(data)*length(centroid.list)),ncol=length(centroid.list))
as.data.frame<- classes
colnames(classes)<- names(centroid.list)
rownames(classes)<- colnames(data)
for( i in 1:length(centroid.list)){
centroids<- centroid.list[[i]]
name<- names(centroid.list)[i]
genes<- rownames(centroids)
k<- ncol(centroids)
Sub_matrix<- data[genes,]
predicted_class <- classify(Sub_matrix,centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
classes[,name]=predicted_class
}
return(classes)
}
classify.multiple<- function(data, centroid.list,distancetype="pearson"){
classes<- matrix(rep(NA,ncol(data)*length(centroid.list)),ncol=length(centroid.list))
as.data.frame<- classes
colnames(classes)<- names(centroid.list)
rownames(classes)<- colnames(data)
for( i in 1:length(centroid.list)){
centroids<- centroid.list[[i]]
name<- names(centroid.list)[i]
genes<- rownames(centroids)
k<- ncol(centroids)
Sub_matrix<- data[genes,]
predicted_class <- classify(Sub_matrix,centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
classes[,name]=predicted_class
}
return(classes)
}
test_classes<- classify.multiple(data=prob_matrix_test,centroid.list= CentroidsList, distancetype = distancetype)
test_classes
load_all()
library(devtools)
load_all()
check()
run_examples()
use_rna_luad
dest_dir <- paste(find.package("galgoR"),"/inst/extdata",sep="")
dest_dir
dest_dir <- paste("~/.galgoR/data/",sep="")
dest_dir
!dir.exists(dest_dir)
dir.exists(dest_dir)
dest_dir
dest_file <- paste(dest_dir,"/luad_data.rds",sep="")
dest_file
load_all()
run_examples()
use_rna_luad
dest_dir <- paste("~/.galgoR/data/",sep="")
dest_dir
!dir.exists(dest_dir)
dest_file <- paste(dest_dir,"luad_data.rds",sep="")
dest_file
file.exists(dest_file)
data<-readRDS(dest_file)
utils::download.file("https://bit.ly/luad_data_galgo",dest_file)
data<-readRDS(dest_file)
dest_file
galgoR
?alloc
?alloc2
?galgoR::alloc2
dest_file
dest_dir
D= readRDS("C:/Users/Usuario/Downloads/luad_data.rds")
D
use_rna_luad <- function(){
dest_dir <- paste(find.package("galgoR"),"/data",sep="")
dest_file <- paste(dest_dir,"/luad_data.rds",sep="")
if (! file.exists(dest_file))
utils::download.file("https://github.com/harpomaxx/galgo/raw/master/data/luad_data.rds",dest_file)
data<-readRDS(dest_file)
}
rm(D)
D<- use_rna_luad()
use_rna_luad <- function(){
#dest_dir <- paste(find.package("galgoR"),"/inst/extdata",sep="")
dest_dir <- paste("~/.galgoR/data/",sep="")
if (!dir.exists(dest_dir))
dir.create(dest_dir,recursive=TRUE)
dest_file <- paste(dest_dir,"luad_data.rds",sep="")
if (! file.exists(dest_file))
utils::download.file("https://bit.ly/luad_data_galgo",dest_file)
data<-readRDS(dest_file)
}
D<- use_rna_luad()
dest_file
readRDS(dest_file)
list.files(dest_file)
file.exist(dest_file)
file.exists(dest_file)
dest_file
file.exists(dest_dir)
list.files(dest_dir)
readRDS("C:/Users/Usuario/Documents/.galgoR/data/luad_data.rds")
D<- use_rna_luad()
readRDS("C:/Users/Usuario/Documents/luad_data.rds")
D= readRDS("C:/Users/Usuario/Downloads/luad_data.rds")
rm(D)
utils::download.file("https://bit.ly/luad_data_galgo",dest_file,quite=FALSE)
readRDS("C:/Users/Usuario/Documents/.galgoR/data/luad_data.rds")
run_examples()
check()
run_examples()
run_examples()
rna_luad <- use_rna_luad()
TCGA_expr <- rna_luad$TCGA$expression_matrix
TCGA_clinic <- rna_luad$TCGA$pheno_data
OS <- survival::Surv(time=TCGA_clinic$time,event=TCGA_clinic$status)
OS
class(OS)
OS[,1]
OS[,2]
output_df<- toDataFrame(output)
NonDom_solutions<- output_df[output_df$Rank==1,]
select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT<-data.frame(solution=as.character(),
k=as.numeric(),
ngenes=as.numeric(),
mean.Silhouette=as.numeric(),
C.Index=as.numeric(),
stringsAsFactors = FALSE)
output <- galgoR::galgo(generations = 10,population = 20, prob_matrix = TCGA_expr, OS = OS)
#' non_dominated_summary(output=output,OS=OS,
#'                       prob_matrix= TCGA_expression,
#'                       distancetype ="pearson",
#'                       usegpu= FALSE)
prob_matrix= TCGA_expression
prob_matrix= TCGA_expr
distancetype ="pearson"
usegpu= FALSE
output_df<- toDataFrame(output)
NonDom_solutions<- output_df[output_df$Rank==1,]
select_distance(distancetype = distancetype,usegpu = usegpu)
RESULT<-data.frame(solution=as.character(),
k=as.numeric(),
ngenes=as.numeric(),
mean.Silhouette=as.numeric(),
C.Index=as.numeric(),
stringsAsFactors = FALSE)
RESULT
output_df
NonDom_solutions
RESULT
i=1
name<- rownames(NonDom_solutions)[i]
genes<- NonDom_solutions[i,"Genes"][[1]]
k<- NonDom_solutions[i,"k"]
Sub_matrix<- prob_matrix[genes,]
D<- calculate_distance(Sub_matrix)
true_class<- cluster_algorithm(D,k)
Centroids <- kcentroid(Sub_matrix,true_class$cluster)
predicted_class <- classify(Sub_matrix,Centroids,method= distancetype)
predicted_class <- as.factor(predicted_class)
predicted_classdf <- as.data.frame(predicted_class)
surv_formula <- stats::as.formula("OS~ predicted_class")
tumortotal <- survival::survfit(surv_formula)
totalsdf <- survival::survdiff(surv_formula)
tumortotalpval <- 1 - stats::pchisq(totalsdf$chisq, length(totalsdf$n) - 1)
tumortotalpval <- format(tumortotalpval, digits=4)
coxsimple=survival::coxph(surv_formula,data=predicted_classdf)
#CI=intsurv::cIndex(stats::predict(coxsimple),surv.time=OS[,1],surv.event=OS[,2],outx=FALSE)$c.index
CI<- intsurv::cIndex(risk_score= stats::predict(coxsimple),time= OS[,1],event= OS[,2])[,"index"]
intsurv::cIndex(risk_score= stats::predict(coxsimple),time= OS[,1],event= OS[,2])
intsurv::cIndex(risk_score= stats::predict(coxsimple),time= OS[,1],event= OS[,2])["index"]
intsurv::cIndex(risk_score= stats::predict(coxsimple),time= OS[,1],event= OS[,2])[,"index"]
run_examples()
run_examples()
rna_luad<-use_rna_luad()
prm <- rna_luad$TCGA$expression_data
clinical <- rna_luad$TCGA$pheno_data
OS <- survival::Surv(time=clinical$time,event=clinical$status)
OS
dim(clinical)
dim(prm)
rm()
run_examples()
prm <- rna_luad$TCGA$expression_matrix
rna_luad<-use_rna_luad()
prm <- rna_luad$TCGA$expression_matrix
Dist= calculate_distance_pearson_cpu(prm)
k=4
Pam= cluster_algorithm(Dist,k)$cluster
centroids <- kcentroid(prm,Pam)
run_examples()
run_examples()
check()
readRDS(dest_file)
dest_dir <- paste("~/.galgoR/data/",sep="")
dest_file <- paste(dest_dir,"luad_data.rds",sep="")
data<-readRDS(dest_file)
